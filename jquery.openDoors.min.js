(function(e){"use strict";var t={init:function(n){return this.each(function(r){this.self=e(this);this.elx=r;t.opt=e.extend(true,{},e.fn.openDoors.defaults,n);var i=t.renderForm.call(this);this.self.html(i);if(t.opt.firstRenderThis){t.result=JSON.parse(t.opt.firstRenderThis);t.renderHours.call(this);if(t.opt.readOnly)return;t._updateHiddenVal.call(this)}t._bindActivePartTime.call(this);t._bindSelectDay.call(this);t._bindSelectAllDays.call(this);t._bindReset.call(this);t._bindSubmit.call(this);t._checkSubmitStatus.call(this)})},renderForm:function(){var e="";e+='<div class="open-doors">';e+='<div class="render-result"></div>';if(!t.opt.readOnly){e+='<div class="head">';e+='<input type="time" class="i1" placeholder="hh:mm"> a <input type="time" class="i2" placeholder="hh:mm">';e+='<input class="part-check" type="checkbox">';e+='<input type="time" class="i3" placeholder="hh:mm" disabled="disabled"> a <input type="time" class="i4" placeholder="hh:mm" disabled="disabled">';e+="</div>";e+='<ul class="days"><li><a href="#">'+t.opt.days.join('</a></li><li><a href="#">')+"</a></li></ul>";e+='<div class="foot">';e+='<span><input type="checkbox" id="h'+this.elx+'" class="select-all"><label for="h'+this.elx+'">Seleccionar todos</label></span>';e+='<input type="submit" value="Guardar"><input type="button" class="reset" value="Cancelar">';e+="</div>";e+='<input type="hidden" name="h'+this.elx+'">'}e+="</div>";return e},_bindActivePartTime:function(){var t=this.self;e(".part-check").on("change",function(){t.find(".i3, .i4").attr("disabled",this.defaultChecked);this.defaultChecked=!this.defaultChecked})},_bindSelectDay:function(){var t=this.self;t.find(".days a").on("click",function(t){t.preventDefault();e(this).hasClass("active")?e(this).removeClass("active"):e(this).addClass("active")})},_bindSelectAllDays:function(){var e=this.self;e.find(".select-all").on("change",function(){var t=e.find(".days a");this.defaultChecked?t.removeClass("active"):t.addClass("active");this.defaultChecked=!this.defaultChecked})},_bindReset:function(){var e=this.self;e.find("input.reset").on("click",function(){e.find(".days a").removeClass("active");e.find(".select-all, .part-check").removeAttr("checked");e.find(".i1, .i2, .i3, .i4").val("");e.find(".i3, .i4").attr("disabled","disabled")})},_bindSubmit:function(){var r=this,i=this.self,s=i.find('input[type="submit"]');s.on("click",function(s){s.preventDefault();var o=i.find(".days .active");if(o.length){var u={},a="",f=i.find(".i1, .i2, .i3, .i4");u.first={};u.first.from=f[0].value;u.first.to=f[1].value;if(!n.validateTime(u))return false;if(i.find(".part-check").is(":checked")){u.last={};u.last.from=f[2].value;u.last.to=f[3].value;if(!n.validateTime(u,true))return false}u.days=[];o.each(function(t,n){a=e(n).text();u.days.push(a)});if(!n.validateExists(u))return false;t.result[t.result.length]=u;t._updateHiddenVal.call(r);t.renderHours.call(r);i.find("input.reset").trigger("click");t.opt.onAfterSave.call()}else{alert("Please, select a day");return false}})},_checkSubmitStatus:function(){var e=this.self;var t=e.find(".i1, .i2")},renderHours:function(){var r=this,i=this.self,s="",o="";e.each(t.result,function(e,r){s+='<div class="days-hours">';s+=n.formatDays(r["days"])+": "+r["first"]["from"]+" - "+r["first"]["to"];s+=r["last"]?" & "+r["last"]["from"]+" - "+r["last"]["to"]:"";s+=t.opt.readOnly?"":'<a href="#" class="remove" data-id="'+e+'">x</a>';s+="</div>";o+=s;s=""});i.find(".render-result").html(o);t._bindRemove.call(r)},_bindRemove:function(){var n=this,r=this.self;r.find(".remove").on("click",function(r){r.preventDefault();var i=e(this).data("id"),s=[],o=0;e.each(t.result,function(e,t){if(e!=i){s[o]=t;o++}});t.result=s;t.renderHours.call(n);t._updateHiddenVal.call(n)})},_updateHiddenVal:function(){var e=this.self,n=this.elx,r=e.find("input[name=h"+n+"]"),i=t.result.length?JSON.stringify(t.result):"";r.val(i)},result:[]};var n={formatDays:function(n){var r="",i=0,s=t.opt.days,o=n.length,u=[],a=function(e,t){for(var n=0;n<e.length;n++){if(e[n]==t)return n}};for(var f=0;f<o;f++){i=parseInt(a(s,n[f]));if(n[f+1]==s[i+1]&&n[f+1]!=undefined){r+=n[f]+"-"}else if(n[f-1]==s[i-1]&&n[f-1]!=undefined){r+=n[f]+","}else{r+=n[f]+","}}r=r.substr(0,r.length-1);u=r.split(",");e.each(u,function(e,t){t=t.split("-");u[e]=t.length>1?t[0]+"-"+t[t.length-1]:t[0]});return u.join(", ")},setError:function(e){return alert("error")},validateTime:function(e,t){var r=new RegExp("(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){1}"),i=false;if(t===undefined){if(e.first.from.match(r)===null){n.setError()}else if(e.first.to.match(r)===null||e.first.to<=e.first.from){n.setError()}else{i=true}}else{if(e.last.from.match(r)===null||e.last.from<=e.first.to){n.setError()}else if(e.last.to.match(r)===null||e.last.to<=e.last.from){n.setError()}else{i=true}}return i},validateExists:function(n){var r=t.result;if(r.length){for(var i=0;i<r.length;i++){for(var s=0;s<r[i].days.length;s++){if(e.inArray(r[i].days[s],n.days)>-1){if(n.first.from>=r[i].first.from&&n.first.from<=r[i].first.to||n.first.to>=r[i].first.from&&n.first.to<=r[i].first.to){alert("El 1er rango de horario se superpone");return false}else if(n.last!==undefined&&r[i].last!==undefined&&(n.last.from>=r[i].last.from&&n.last.from<=r[i].last.to||n.last.to>=r[i].last.from&&n.last.to<=r[i].last.to)){alert("El 2do rango de horario se superpone");return false}}}}}return true}};e.fn.openDoors=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist!")}};e.fn.openDoors.defaults={days:["lun","mar","mie","jue","vie","sab","dom"],firstRenderThis:false,readOnly:false,onAfterSave:function(){}}})(jQuery)